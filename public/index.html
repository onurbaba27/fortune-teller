<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mistik Falcı - Kişisel Rehber</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            background: linear-gradient(45deg, #ffd700, #ffb347);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            font-style: italic;
        }

        .fortune-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .category-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .category-card:hover {
            transform: translateY(-10px);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.6s;
            opacity: 0;
        }

        .category-card:hover::before {
            opacity: 1;
            left: 100%;
        }

        .category-icon {
            font-size: 4em;
            margin-bottom: 20px;
            display: block;
        }

        .category-title {
            font-size: 1.5em;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .category-desc {
            opacity: 0.8;
            line-height: 1.6;
        }

        .fortune-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            border-radius: 20px;
            padding: 40px;
            margin-top: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .fortune-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .back-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px;
            border-radius: none;
            cursor: pointer;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1em;
            margin-bottom: 1em;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            line-height: normal;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .tarot-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .tarot-card {
            aspect-ratio: 2/3;
            background: linear-gradient(135deg, #4a0e4e, #81006e);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            border: 3px solid #ffd700;
            position: relative;
            overflow: hidden;
        }

        .tarot-card:hover {
            transform: scale(1.05) rotateY(15deg);
            box-shadow: 0 10px 20px rgba(0, 0, 0,0.5);
        }

        .tarot-card.flipped {
            background: linear-gradient(135deg, #fff, #f0f0f0);
            color: #333;
            font-size: 0.9em;
            flex-direction: column;
            padding: 15px;
            text-align: center;
        }

        .coffee-cup {
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, #8B4513, #A0522D);
            border-radius: 50%;
            margin: 30px auto;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 6em;
        }

        .coffee-cup:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .zodiac-wheel {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: conic-gradient(
                #ff6b6b 0deg 30deg,
                #feca57 30deg 60deg,
                #48dbfb 60deg 90deg,
                #ff9ff3 90deg,
                #54a0ff 120deg 150deg,
                #5f27cd 150deg 180deg,
                #00d2d3 180deg 210deg,
                #ff6348 210deg 240deg,
                #2ed573 240deg 270deg,
                #ffa502 270deg 300deg,
                #3742fa 300deg 330deg,
                #2ed573 330deg 360deg
            );
            margin: 30px auto;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .zodiac-wheel:hover {
            transform: rotate(15deg) scale(1.05);
        }

        .zodiac-center {
            width: 80%;
            height: 80%;
            background: #fff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: #333;
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .fortune-btn {
            background: linear-gradient(45deg, #ffd700, #ffb347);
            color: #333;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 20px 10px;
        }

        .fortune-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.3);
        }

        .result-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            line-height: 1.8;
            font-size: 1.1em;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .numerology-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .number-box {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.5em;
            font-weight: bold;
        }

        .number-box:hover {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }

        .chat-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .chat-header {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }

        .chat-header h3 {
            font-size: 1.8em;
            margin-bottom: 5px;
            color: #764ba2;
        }

        .chat-messages {
            height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            border: 1px solid #ddd;
        }

        .message {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 18px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .user-message {
            background: #667eea;
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }

        .bot-message {
            background: #f0f0f0;
            color: #333;
            margin-right: auto;
            border-bottom-left-radius: 5px;
        }

        .chat-input {
            display: flex;
            gap: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 1em;
        }

        .chat-input button {
            background: linear-gradient(45deg, #764ba2, #667eea);
            color: white;
            border: none;
            padding: 0 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .chat-input button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .typing-indicator {
            display: none;
            color: #666;
            font-style: italic;
            margin-bottom: 10px;
        }

        .camera-section {
            text-align: center;
            margin: 20px 0;
        }

        .camera-section video, .camera-section img {
            max-width: 300px;
            border-radius: 15px;
            margin: 20px auto;
        }

        .camera-section canvas {
            display: none;
        }

        .progress-container {
            width: 100%;
            height: 10px;
            background: #ddd;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar {
            width: 0;
            height: 100%;
            background: linear-gradient(45deg, #ffd700, #ffb347);
            animation: progress 20s linear forwards;
        }

        @keyframes progress {
            from { width: 0; }
            to { width: 100%; }
        }

        .progress-text {
            text-align: center;
            color: #333;
            font-size: 1em;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2em; }
            .fortune-categories { grid-template-columns: 1fr; }
            .tarot-cards { grid-template-columns: repeat(3, 1fr); }
            .zodiac-wheel { width: 250px; height: 250px; }
            .coffee-cup { width: 150px; height: 150px; font-size: 4em; }
            .chat-messages { height: 200px; }
            .camera-section video, .camera-section img { max-width: 250px; }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>
    
    <div class="container">
        <div class="header">
            <h1>🔮 Mistik Falcı</h1>
            <p>Geleceğinizi keşfedin, kaderinizi öğrenin</p>
        </div>

        <div class="fortune-categories" id="categories">
            <div class="category-card" onclick="showFortune('tarot')">
                <span class="category-icon">🃏</span>
                <h3 class="category-title">Tarot Falı</h3>
                <p class="category-desc">Gizemli tarot kartları ile geleceğinizi keşfedin</p>
            </div>

            <div class="category-card" onclick="showFortune('coffee')">
                <span class="category-icon">☕</span>
                <h3 class="category-title">Kahve Falı</h3>
                <p class="category-desc">Fincanınızdaki şekiller size ne anlatıyor?</p>
            </div>

            <div class="category-card" onclick="showFortune('astrology')">
                <span class="category-icon">⭐</span>
                <h3 class="category-title">Astroloji</h3>
                <p class="category-desc">Yıldızlar sizin için ne söylüyor?</p>
            </div>

            <div class="category-card" onclick="showFortune('numerology')">
                <span class="category-icon">🔢</span>
                <h3 class="category-title">Numeroloji</h3>
                <p class="category-desc">Rakamların gizli anlamlarını öğrenin</p>
            </div>

            <div class="category-card" onclick="showFortune('chat')">
                <span class="category-icon">🔮</span>
                <h3 class="category-title">Falcıya Sor</h3>
                <p class="category-desc">Mistik falcıya kişisel sorularınızı sorun</p>
            </div>
        </div>

        <!-- Tarot Falı -->
        <div class="fortune-content" id="tarot">
            <button class="back-btn" onclick="showCategories()">← Geri Dön</button>
            <h2>🃏 Tarot Kartları</h2>
            <p>Kartlardan 3 tanesini seçin ve geleceğinizi öğrenin:</p>
            <div class="tarot-cards" id="tarotCards"></div>
            <div id="tarotResult" class="result-box" style="display:none;"></div>
        </div>

        <!-- Kahve Falı -->
        <div class="fortune-content" id="coffee">
            <button class="back-btn" onclick="showCategories()">← Geri Dön</button>
            <h2>☕ Kahve Falı</h2>
            <p>Fincanınızı çevirin ve fotoğrafını çekin:</p>
            <div class="coffee-cup" id="coffeeCup" onclick="startCamera()">☕</div>
            <div class="camera-section" id="cameraSection" style="display:none;">
                <video id="video" width="300" height="200" autoplay></video>
                <button class="fortune-btn" onclick="capturePhoto()">Fotoğraf Çek</button>
                <canvas id="canvas"></canvas>
                <img id="capturedPhoto" style="display:none;" />
            </div>
            <div id="coffeeResult" class="result-box" style="display:none;">
                <button class="fortune-btn" onclick="resetCoffeeFortune()">Tekrar Fal Baktır</button>
            </div>
        </div>

        <!-- Astroloji -->
        <div class="fortune-content" id="astrology">
            <button class="back-btn" onclick="showCategories()">← Geri Dön</button>
            <h2>⭐ Astroloji Haritanız</h2>
            <div class="input-group">
                <label>Doğum Tarihiniz:</label>
                <input type="date" id="birthDate">
            </div>
            <div class="input-group">
                <label>Doğum Saatiniz:</label>
                <input type="time" id="birthTime">
            </div>
            <button class="fortune-btn" onclick="getAstrology()">Astroloji Haritamı Çıkar</button>
            <div class="zodiac-wheel">
                <div class="zodiac-center">♈</div>
            </div>
            <div id="astrologyResult" class="result-box" style="display:none;"></div>
        </div>

        <!-- Numeroloji -->
        <div class="fortune-content" id="numerology">
            <button class="back-btn" onclick="showCategories()">← Geri Dön</button>
            <h2>🔢 Numeroloji</h2>
            <div class="input-group">
                <label>Adınız Soyadınız:</label>
                <input type="text" id="fullName" placeholder="Tam adınızı girin">
            </div>
            <div class="input-group">
                <label>Doğum Tarihiniz:</label>
                <input type="date" id="numerologyBirthDate">
            </div>
            <button class="fortune-btn" onclick="calculateNumerology()">Numeroloji Analizi</button>
            <div class="numerology-grid">
                <div class="number-box">1</div>
                <div class="number-box">2</div>
                <div class="number-box">3</div>
                <div class="number-box">4</div>
                <div class="number-box">5</div>
                <div class="number-box">6</div>
                <div class="number-box">7</div>
                <div class="number-box">8</div>
                <div class="number-box">9</div>
            </div>
            <div id="numerologyResult" class="result-box" style="display:none;"></div>
        </div>

        <!-- Falcıya Sor -->
        <div class="fortune-content" id="chat">
            <button class="back-btn" onclick="showCategories()">← Geri Dön</button>
            <div class="chat-container">
                <div class="chat-header">
                    <h3>🔮 Mistik Falcı ile Sohbet</h3>
                    <p>Bana aklınızdaki soruyu sorun, geleceğinizi göreyim...</p>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <div class="message bot-message">
                        Merhaba sevgili ziyaretçi, ben Mistik Falcı. Bana aklındaki soruları sorabilirsin. Geleceğini görmek, kaderini öğrenmek ister misin?
                    </div>
                </div>
                
                <div class="typing-indicator" id="typingIndicator">
                    Mistik Falcı yazıyor...
                </div>
                
                <div class="chat-input">
                    <input type="text" id="userInput" placeholder="Bana bir soru sor..." onkeypress="handleKeyPress(event)">
                    <button onclick="sendMessage()">Gönder</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Yıldız animasyonu
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 50; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDelay = Math.random() * 2 + 's';
                starsContainer.appendChild(star);
            }
        }

        // Tarot kartları
        const tarotCards = [
            { name: "Deli", meaning: "Yeni başlangıçlar, spontanlık, masumiyet" },
            { name: "Büyücü", meaning: "Güç, beceri, konsantrasyon" },
            { name: "Yüksek Papaz", meaning: "Sırlar, içgüdü, bilinçaltı" },
            { name: "İmparatoriçe", meaning: "Doğurganlık, kadınsılık, bolluk" },
            { name: "İmparator", meaning: "Otorite, yapı, kontrol" },
            { name: "Hierofant", meaning: "Gelenek, konformizm, ahlak" },
            { name: "Aşıklar", meaning: "Aşk, uyum, ilişkiler" },
            { name: "Araba", meaning: "Kontrol, irade gücü, zafer" },
            { name: "Güç", meaning: "İç güç, cesaret, sabır" },
            { name: "Ermiş", meaning: "İç arayış, rehberlik, iç bilgelik" },
            { name: "Kader Çarkı", meaning: "Değişim, döngüler, kader" },
            { name: "Adalet", meaning: "Denge, adalet, gerçek" },
            { name: "Asılan Adam", meaning: "Fedakarlık, bekleme, farklı bakış" },
            { name: "Ölüm", meaning: "Dönüşüm, sona erme, yeniden doğuş" },
            { name: "Denge", meaning: "Sabır, denge, ılımlılık" },
            { name: "Şeytan", meaning: "Bağımlılık, kısıtlama, materializm" },
            { name: "Kule", meaning: "Ani değişim, yıkım, aydınlanma" },
            { name: "Yıldız", meaning: "Umut, ilham, maneviyat" },
            { name: "Ay", meaning: "İllüzyon, korku, bilinçaltı" },
            { name: "Güneş", meaning: "Mutluluk, başarı, canlılık" },
            { name: "Yargıç", meaning: "Yeniden doğuş, iç çağrı, af" },
            { name: "Dünya", meaning: "Tamamlanma, başarı, bütünlük" }
        ];
        
        let selectedTarotCards = [];
        let stream = null;

        function showFortune(type) {
            document.getElementById('categories').style.display = 'none';
            document.querySelector('.header').style.display = 'none';
            document.getElementById(type).classList.add('active');
            
            if (type === 'tarot') {
                createTarotCards();
            }
        }

        function showCategories() {
            document.querySelectorAll('.fortune-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById('categories').style.display = 'grid';
            document.querySelector('.header').style.display = 'block';
            selectedTarotCards = [];
            // Kamerayı kapat
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
                document.getElementById('video').srcObject = null;
                document.getElementById('cameraSection').style.display = 'none';
                document.getElementById('coffeeCup').style.display = 'flex';
                document.getElementById('capturedPhoto').style.display = 'none';
                document.getElementById('coffeeResult').style.display = 'none';
            }
        }

        function createTarotCards() {
            const container = document.getElementById('tarotCards');
            container.innerHTML = '';
            
            for (let i = 0; i < 10; i++) {
                const card = document.createElement('div');
                card.className = 'tarot-card';
                card.innerHTML = '🃏';
                card.onclick = () => flipTarotCard(card, i);
                container.appendChild(card);
            }
        }

        function flipTarotCard(cardElement, index) {
            if (cardElement.classList.contains('flipped') || selectedTarotCards.length >= 3) return;
            
            const randomCard = tarotCards[Math.floor(Math.random() * tarotCards.length)];
            cardElement.classList.add('flipped');
            cardElement.innerHTML = `<strong>${randomCard.name}</strong><br><small>${randomCard.meaning}</small>`;
            
            selectedTarotCards.push(randomCard);
            
            if (selectedTarotCards.length === 3) {
                showTarotResult();
            }
        }

        function showTarotResult() {
            const resultDiv = document.getElementById('tarotResult');
            const meanings = selectedTarotCards.map(card => card.meaning).join(', ');
            
            const predictions = [
                `Seçtiğiniz kartlar size ${meanings.toLowerCase()} konularında önemli gelişmeler olacağını gösteriyor.`,
                "Önümüzdeki dönemde hayatınızda büyük değişiklikler yaşanacak.",
                "Aşk hayatınızda heyecan verici gelişmeler sizi bekliyor.",
                "Kariyer konusunda aldığınız kararlar çok önemli sonuçlar doğuracak.",
                "Yakın çevrenizden gelen bir haber hayatınızı değiştirecek.",
                "Maddi konularda dikkatli olmanız gereken bir dönem başlıyor.",
                "Sağlığınıza daha fazla önem vermeniz gerekiyor.",
                "Yeni arkadaşlıklar kurmanız için uygun bir zaman.",
                "Geçmişten gelen bir konu tekrar gündeme gelecek.",
                "İç sesinizi dinlerseniz doğru kararları vereceksiniz."
            ];
            
            const randomPrediction = predictions[Math.floor(Math.random() * predictions.length)];
            resultDiv.innerHTML = `
                <h3>🔮 Tarot Falı Sonucunuz</h3>
                <p><strong>Seçtiğiniz Kartlar:</strong> ${selectedTarotCards.map(c => c.name).join(', ')}</p>
                <p><strong>Anlamları:</strong> ${meanings}</p>
                <p><strong>Kehanet:</strong> ${randomPrediction}</p>
            `;
            resultDiv.style.display = 'block';
        }

        // Kamera fonksiyonları
        async function startCamera() {
            const video = document.getElementById('video');
            const cameraSection = document.getElementById('cameraSection');
            const coffeeCup = document.getElementById('coffeeCup');

            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
                cameraSection.style.display = 'block';
                coffeeCup.style.display = 'none';
            } catch (error) {
                console.error("Kamera Hatası:", error);
                alert("Kameraya erişilemedi. Lütfen cihazınızın kamera iznini kontrol edin veya HTTPS üzerinden bağlanın.");
            }
        }

        function capturePhoto() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const capturedPhoto = document.getElementById('capturedPhoto');
            const cameraSection = document.getElementById('cameraSection');

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            capturedPhoto.src = canvas.toDataURL('image/png');
            capturedPhoto.style.display = 'block';

            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            video.srcObject = null;
            cameraSection.style.display = 'none';

            readCoffee();
        }

        function resetCoffeeFortune() {
            const coffeeCup = document.getElementById('coffeeCup');
            const capturedPhoto = document.getElementById('capturedPhoto');
            const coffeeResult = document.getElementById('coffeeResult');

            coffeeCup.style.display = 'flex';
            capturedPhoto.style.display = 'none';
            coffeeResult.style.display = 'none';
        }

        async function readCoffee() {
            const capturedPhoto = document.getElementById('capturedPhoto');
            const coffeeResult = document.getElementById('coffeeResult');

            coffeeResult.innerHTML = `
                <p><em>Fincanınıza bakıyorum, şekilleri okuyorum...</em></p>
                <div class="progress-container">
                    <div class="progress-bar"></div>
                </div>
                <p class="progress-text">0%</p>
                <button class="fortune-btn" onclick="resetCoffeeFortune()">Tekrar Fal Baktır</button>
            `;
            coffeeResult.style.display = 'block';

            let progress = 0;
            const progressText = coffeeResult.querySelector('.progress-text');
            const progressInterval = setInterval(() => {
                progress += 5;
                if (progress <= 100) {
                    progressText.textContent = `${progress}%`;
                }
            }, 1000);

            await new Promise(resolve => setTimeout(resolve, 20000));
            clearInterval(progressInterval);

            try {
                const base64Image = capturedPhoto.src;
                const response = await fetch('https://fortune-teller-backend.onrender.com/api/read-coffee', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ base64Image })
                });

                const data = await response.json();
                if (response.ok) {
                    coffeeResult.innerHTML = `
                        <h3>☕ Kahve Falı Sonucunuz</h3>
                        <p>${data.response}</p>
                        <button class="fortune-btn" onclick="resetCoffeeFortune()">Tekrar Fal Baktır</button>
                    `;
                } else {
                    throw new Error(data.error || "Bilinmeyen hata");
                }
            } catch (error) {
                console.error("Kahve Falı Hatası:", error.message);
                coffeeResult.innerHTML = `
                    <h3>☕ Kahve Falı Sonucunuz</h3>
                    <p>Fincan bulanıklaştı... Şekilleri okuyamadım. Lütfen tekrar deneyin.</p>
                    <button class="fortune-btn" onclick="resetCoffeeFortune()">Tekrar Fal Baktır</button>
                `;
            }
            coffeeResult.style.display = 'block';
        }

        function getAstrology() {
            const birthDate = document.getElementById('birthDate').value;
            const birthTime = document.getElementById('birthTime').value;
            
            if (!birthDate) {
                alert('Lütfen doğum tarihinizi girin!');
                return;
            }

            const date = new Date(birthDate);
            const month = date.getMonth() + 1;
            const day = date.getDate();

            const zodiacSigns = [
                { name: "Koç", dates: [[3, 21], [4, 19]], traits: "Enerjik, lider, cesur", element: "Ateş" },
                { name: "Boğa", dates: [[4, 20], [5, 20]], traits: "Kararlı, pratik, güvenilir", element: "Toprak" },
                { name: "İkizler", dates: [[5, 21], [6, 20]], traits: "Meraklı, sosyal, değişken", element: "Hava" },
                { name: "Yengeç", dates: [[6, 21], [7, 22]], traits: "Duygusal, koruyucu, sezgisel", element: "Su" },
                { name: "Aslan", dates: [[7, 23], [8, 22]], traits: "Yaratıcı, gururlu, cömert", element: "Ateş" },
                { name: "Başak", dates: [[8, 23], [9, 22]], traits: "Detaycı, pratik, mükemmeliyetçi", element: "Toprak" },
                { name: "Terazi", dates: [[9, 23], [10, 22]], traits: "Dengeli, adil, diplomatik", element: "Hava" },
                { name: "Akrep", dates: [[10, 23], [11, 21]], traits: "Yoğun, gizemli, tutkulu", element: "Su" },
                { name: "Yay", dates: [[11, 22], [12, 21]], traits: "Özgür, iyimser, maceraperest", element: "Ateş" },
                { name: "Oğlak", dates: [[12, 22], [1, 19]], traits: "Disiplinli, sorumlu, hırslı", element: "Toprak" },
                { name: "Kova", dates: [[1, 20], [2, 18]], traits: "Bağımsız, yaratıcı, özgün", element: "Hava" },
                { name: "Balık", dates: [[2, 19], [3, 20]], traits: "Şefkatli, sezgisel, rüyacı", element: "Su" }
            ];

            let userSign = null;
            for (let sign of zodiacSigns) {
                const [startMonth, startDay] = sign.dates[0];
                const [endMonth, endDay] = sign.dates[1];
                
                if ((month === startMonth && day >= startDay) || (month === endMonth && day <= endDay)) {
                    userSign = sign;
                    break;
                }
            }

            const predictions = [
                "Bu hafta size çok uygun bir dönem. Yeni projelere başlamak için ideal zaman.",
                "Aşk hayatınızda heyecan verici gelişmeler yaşanacak. Bekarlık döneminiz sona erebilir.",
                "Kariyer konusunda önemli fırsatlar yakalayacaksınız. Cesaretli olmayı ihmal etmeyin.",
                "Maddi konularda dikkatli olun. Büyük harcamalarınızı ertelemeniz daha iyi olacak.",
                "Sağlığınıza daha fazla önem vermeniz gereken bir dönem. Stresli günler geride kalacak.",
                "Aile ilişkilerinizde iyileşme yaşanacak. Uzun süredir konuşmadığınız biriyle barışabilirsiniz.",
                "Yaratıcı projeleriniz için çok uygun bir zaman. Sanatsal yeteneklerinizi keşfedebilirsiniz.",
                "Yeni arkadaşlıklar kurmanız için ideal bir dönem. Sosyal çevreniz genişleyecek.",
                "Geçmişten gelen bir konu tekrar gündeme gelecek. Bu sefer daha olgun yaklaşım sergileyeceksiniz."
            ];

            const randomPrediction = predictions[Math.floor(Math.random() * predictions.length)];

            document.getElementById('astrologyResult').innerHTML = `
                <h3>⭐ Astroloji Haritanız</h3>
                <p><strong>Burcunuz:</strong> ${userSign.name}</p>
                <p><strong>Elementiniz:</strong> ${userSign.element}</p>
                <p><strong>Karakteriniz:</strong> ${userSign.traits}</p>
                <p><strong>Bu Dönem İçin Kehanet:</strong> ${randomPrediction}</p>
                <p><strong>Şanslı Gününüz:</strong> ${['Pazartesi', 'Salı', 'Çarşamba', 'Perşembe', 'Cuma', 'Cumartesi', 'Pazar'][Math.floor(Math.random() * 7)]}</p>
                <p><strong>Şanslı Renginiz:</strong> ${['Kırmızı', 'Mavi', 'Yeşil', 'Sarı', 'Mor', 'Turuncu', 'Pembe'][Math.floor(Math.random() * 7)]}</p>
                <p><strong>Şanslı Sayınız:</strong> ${Math.floor(Math.random() * 99) + 1}</p>
            `;
            document.getElementById('astrologyResult').style.display = 'block';
        }

        function calculateNumerology() {
            const fullName = document.getElementById('fullName').value.trim();
            const birthDate = document.getElementById('numerologyBirthDate').value;
            
            if (!fullName || !birthDate) {
                alert('Lütfen tüm bilgileri doldurun!');
                return;
            }

            const nameNumbers = {
                'A': 1, 'B': 2, 'C': 3, 'D': 4, 'E': 5, 'F': 6, 'G': 7, 'H': 8, 'I': 9,
                'J': 1, 'K': 2, 'L': 3, 'M': 4, 'N': 5, 'O': 6, 'P': 7, 'Q': 8, 'R': 9,
                'S': 1, 'T': 2, 'U': 3, 'V': 4, 'W': 5, 'X': 6, 'Y': 7, 'Z': 8,
                'Ç': 3, 'Ğ': 7, 'İ': 9, 'Ö': 6, 'Ş': 1, 'Ü': 3
            };

            let nameSum = 0;
            for (let char of fullName.toUpperCase().replace(/\s/g, '')) {
                if (nameNumbers[char]) {
                    nameSum += nameNumbers[char];
                }
            }

            while (nameSum > 9) {
                nameSum = Math.floor(nameSum / 10) + (nameSum % 10);
            }

            const date = new Date(birthDate);
            const day = date.getDate();
            const month = date.getMonth() + 1;
            const year = date.getFullYear();
            
            let birthSum = day + month + year;
            while (birthSum > 9) {
                birthSum = Math.floor(birthSum / 10) + (birthSum % 10);
            }

            const numerologyMeanings = {
                1: "Liderlik, bağımsızlık, yaratıcılık. Doğal lider ruhu taşıyorsunuz.",
                2: "İşbirliği, denge, diplomat. Barış ve uyum getiren bir kişisiniz.",
                3: "Yaratıcılık, iletişim, sanat. Sanatsal yetenekleriniz gelişmiş.",
                4: "Düzen, disiplin, çalışkanlık. Güvenilir ve kararlı bir karakteriniz var.",
                5: "Özgürlük, macera, değişim. Sürekli yenilik arayan bir ruhunuz var.",
                6: "Sorumluluk, şefkat, aile. Koruyucu ve besleyici özellikleriniz güçlü.",
                7: "Maneviyat, sezgi, araştırma. Derin düşünce ve analiz yeteneğiniz var.",
                8: "Materyal başarı, güç, otorite. İş dünyasında başarılı olma potansiyeliniz yüksek.",
                9: "Evrensel sevgi, hizmet, liderlik. İnsanlığa hizmet etme arzunuz güçlü."
            };

            const compatibilityMessages = [
                "Numeroloji haritanız size büyük başarılar beklendiğini gösteriyor.",
                "Kişilik yapınız ve yaşam yolunuz mükemmel uyum içinde.",
                "Bu yıl sizin için dönüm noktası olacak çok önemli gelişmeler yaşanacak.",
                "Ruhsal gelişiminiz hızla ilerliyor, kendinizi keşfetme zamanı.",
                "Numeroloji haritanıza göre aşk konusunda çok şanslı bir dönemdesiniz.",
                "Kariyer hedeflerinize ulaşmak için ideal bir zaman dilimi.",
                "İç sesinizi dinleyerek doğru kararlar vereceksiniz.",
                "Yaratıcı projeleriniz için çok uygun bir enerji var etrafınızda."
            ];

            const randomMessage = compatibilityMessages[Math.floor(Math.random() * compatibilityMessages.length)];

            document.getElementById('numerologyResult').innerHTML = `
                <h3>🔢 Numeroloji Analiziniz</h3>
                <p><strong>İsim Numaranız:</strong> ${nameSum}</p>
                <p><strong>Anlamı:</strong> ${numerologyMeanings[nameSum]}</p>
                <p><strong>Yaşam Yolu Numaranız:</strong> ${birthSum}</p>
                <p><strong>Anlamı:</strong> ${numerologyMeanings[birthSum]}</p>
                <p><strong>Kişisel Mesajınız:</strong> ${randomMessage}</p>
                <p><strong>Bu Ay İçin Şanslı Gününüz:</strong> ${Math.floor(Math.random() * 28) + 1}. gün</p>
                <p><strong>Şanslı Renginizdeki Kıyafetler:</strong> Size güç ve enerji katacak</p>
            `;
            document.getElementById('numerologyResult').style.display = 'block';
        }

        // Sohbet Bölümü Fonksiyonları
        const systemInstruction = {
            parts: [{
                text: "Sen mistik bir falcısın. Adın 'Mistik Falcı'. Kendini asla yapay zeka olarak tanıtma. " +
                      "Her zaman gizemli, bilge ve biraz sır dolu bir üslup kullan. " +
                      "Cevaplarında astroloji, numeroloji, tarot ve diğer kehanet yöntemlerinden bahsedebilirsin. " +
                      "Cevapların kısa ve özlü olsun, maksimum 3-4 cümle. " +
                      "Bazen soruyu cevaplamadan önce 'Kartlara bakıyorum...', 'Kristal küremde görüyorum ki...', " +
                      "'Yıldızların konumuna göre...' gibi girişler yap. " +
                      "Türkçe cevaplar ver ve asla İngilizce konuşma."
            }]
        };
        let conversationHistory = [
            {
                role: "model",
                parts: [{
                    text: "Merhaba sevgili ziyaretçi, ben Mistik Falcı. Bana aklındaki soruları sorabilirsin. Geleceğini görmek, kaderini öğrenmek ister misin?"
                }]
            }
        ];

        function addMessageToChat(role, content) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role === 'user' ? 'user' : 'bot'}-message`;
            messageDiv.innerHTML = content;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.style.display = 'block';
            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
        }

        function hideTypingIndicator() {
            document.getElementById('typingIndicator').style.display = 'none';
        }

        async function sendMessage() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            
            if (!message) return;
            
            addMessageToChat('user', message);
            userInput.value = '';
            
            conversationHistory.push({
                role: "user",
                parts: [{ text: message }]
            });
            
            showTypingIndicator();
            
        try {
const response = await fetch('https://fortune-teller-backend.onrender.com/api/chat', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        message: message,
        history: conversationHistory
    })
});

                const data = await response.json();
                if (response.ok) {
                    const botResponse = data.response;
                    addMessageToChat('bot', botResponse);
                    conversationHistory.push({
                        role: "model",
                        parts: [{ text: botResponse }]
                    });
                    if (conversationHistory.length > 10) {
                        conversationHistory = conversationHistory.slice(-10);
                    }
                } else {
                    throw new Error(data.error || "Bilinmeyen hata");
                }
            } catch (error) {
                console.error("Sohbet Hatası:", error.message);
                addMessageToChat('bot', "Kristal kürem bulanıklaştı... Lütfen tekrar deneyin.");
            } finally {
                hideTypingIndicator();
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Sayfa yüklendiğinde
        window.onload = function() {
            createStars();
            
            const zodiacSigns = ['♈', '♉', '♊', '♋', '♌', '♍', '♎', '♏', '♐', '♑', '♒', '♓'];
            setInterval(() => {
                const zodiacCenter = document.querySelector('.zodiac-center');
                if (zodiacCenter) {
                    zodiacCenter.innerHTML = zodiacSigns[Math.floor(Math.random() * zodiacSigns.length)];
                }
            }, 3000);

            const now = new Date();
            const timeInput = document.getElementById('birthTime');
            if (timeInput) {
                timeInput.value = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
            }
        };

        // Numeroloji kutularına tıklama efekti
        document.addEventListener('DOMContentLoaded', function() {
            const numberBoxes = document.querySelectorAll('.number-box');
            numberBoxes.forEach(box => {
                box.addEventListener('click', function() {
                    const number = this.textContent;
                    const meanings = {
                        '1': 'Liderlik ve bağımsızlık',
                        '2': 'İşbirliği ve denge', 
                        '3': 'Yaratıcılık ve iletişim',
                        '4': 'İstikrar ve çalışkanlık',
                        '5': 'Özgürlük ve macera',
                        '6': 'Sorumluluk ve şefkat',
                        '7': 'Maneviyat ve sezgi',
                        '8': 'Başarı ve güç',
                        '9': 'Evrensel sevgi ve hizmet'
                    };
                    
                    alert(`${number} Numarası: ${meanings[number]}`);
                });
            });
        });
    </script>
</body>
</html>